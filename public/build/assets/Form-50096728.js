import{T as $,f as _,o as n,b as i,a as e,t as u,g as B,h as b,v as k,u as d,F as v,i as h,e as y,j as w,k as I,w as j,l as L,m as q}from"./app-78229063.js";const O={class:"py-12"},z={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Q={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},R={class:"text-2xl font-semibold text-gray-800 mb-6"},G=["value"],H={key:0,class:"text-red-500 text-sm mt-1"},J={key:0,class:"text-red-500 text-sm mt-1"},K={key:0,class:"text-red-500 text-sm mt-1"},W={class:"space-y-4"},X={class:"flex-1"},Y={class:"flex items-center mb-2"},Z=["onClick"],ee={key:0,class:"relative"},oe=["onUpdate:modelValue","onInput"],te={key:0,class:"absolute z-10 w-full mt-1 bg-white shadow-lg max-h-60 rounded-md py-1 text-base overflow-auto"},se=["onClick"],re=["onUpdate:modelValue"],ae=["value"],de={class:"w-32"},le=["onUpdate:modelValue"],ne=["onClick"],ie={class:"border-t pt-4"},ue={class:"text-right"},ce={class:"text-lg font-semibold"},me={class:"flex justify-end space-x-3"},be=["disabled"],fe={__name:"Form",props:{albaran:{type:Object,default:null},clientes:{type:Array,required:!0},productos:{type:Array,required:!0}},setup(f){var C,V,U,S,P;const c=f,t=$({cliente_id:((C=c.albaran)==null?void 0:C.cliente_id)||"",fecha:((V=c.albaran)==null?void 0:V.fecha)||new Date().toISOString().split("T")[0],estado:((U=c.albaran)==null?void 0:U.estado)||"pendiente",productos:((S=c.albaran)==null?void 0:S.productos)||[],observaciones:((P=c.albaran)==null?void 0:P.observaciones)||""}),p=_([]),m=_([]),g=_([]),F=s=>{var r;const o=(r=p.value[s])==null?void 0:r.toLowerCase();if(!o){m.value[s]=[];return}m.value[s]=c.productos.filter(l=>l.id.toString().includes(o)||l.nombre.toLowerCase().includes(o)).slice(0,10)},M=(s,o)=>{t.productos[o].producto_id=s.id,p.value[o]=`${s.id} - ${s.nombre}`,m.value[o]=[]},A=()=>{t.productos.push({producto_id:"",cantidad:1}),p.value.push(""),m.value.push([]),g.value.push(!1)},D=s=>{t.productos.splice(s,1),p.value.splice(s,1),m.value.splice(s,1),g.value.splice(s,1)},E=s=>{g.value[s]=!g.value[s]},N=()=>t.productos.reduce((s,o)=>{const r=c.productos.find(l=>l.id===o.producto_id);return s+(r?r.precio*o.cantidad:0)},0),x=s=>new Intl.NumberFormat("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s),T=()=>{c.albaran?t.put(`/albaranes/${c.albaran.id}`):t.post("/albaranes")};return(s,o)=>(n(),i("div",O,[e("div",z,[e("div",Q,[e("h2",R,u(f.albaran?"Editar Albarán":"Nuevo Albarán"),1),e("form",{onSubmit:B(T,["prevent"]),class:"space-y-6"},[e("div",null,[o[5]||(o[5]=e("label",{for:"cliente_id",class:"block text-sm font-medium text-gray-700"},"Cliente",-1)),b(e("select",{id:"cliente_id","onUpdate:modelValue":o[0]||(o[0]=r=>d(t).cliente_id=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[o[4]||(o[4]=e("option",{value:""},"Seleccionar cliente",-1)),(n(!0),i(v,null,h(f.clientes,r=>(n(),i("option",{key:r.id,value:r.id},u(r.nombre),9,G))),128))],512),[[k,d(t).cliente_id]]),d(t).errors.cliente_id?(n(),i("div",H,u(d(t).errors.cliente_id),1)):y("",!0)]),e("div",null,[o[6]||(o[6]=e("label",{for:"fecha",class:"block text-sm font-medium text-gray-700"},"Fecha",-1)),b(e("input",{type:"date",id:"fecha","onUpdate:modelValue":o[1]||(o[1]=r=>d(t).fecha=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[w,d(t).fecha]]),d(t).errors.fecha?(n(),i("div",J,u(d(t).errors.fecha),1)):y("",!0)]),e("div",null,[o[8]||(o[8]=e("label",{for:"estado",class:"block text-sm font-medium text-gray-700"},"Estado",-1)),b(e("select",{id:"estado","onUpdate:modelValue":o[2]||(o[2]=r=>d(t).estado=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},o[7]||(o[7]=[e("option",{value:"pendiente"},"Pendiente",-1),e("option",{value:"en_proceso"},"En Proceso",-1),e("option",{value:"completado"},"Completado",-1),e("option",{value:"entregado"},"Entregado",-1)]),512),[[k,d(t).estado]]),d(t).errors.estado?(n(),i("div",K,u(d(t).errors.estado),1)):y("",!0)]),e("div",null,[o[11]||(o[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Productos",-1)),e("div",W,[(n(!0),i(v,null,h(d(t).productos,(r,l)=>(n(),i("div",{key:l,class:"flex items-center gap-4"},[e("div",X,[e("div",Y,[e("button",{type:"button",onClick:a=>E(l),class:"text-sm text-indigo-600 hover:text-indigo-800"},u(g.value[l]?"Usar lista desplegable":"Usar buscador"),9,Z)]),g.value[l]?(n(),i("div",ee,[b(e("input",{type:"text","onUpdate:modelValue":a=>p.value[l]=a,onInput:()=>F(l),placeholder:"Buscar producto por nombre o ID...",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,40,oe),[[w,p.value[l]]]),m.value[l].length>0?(n(),i("div",te,[(n(!0),i(v,null,h(m.value[l],a=>(n(),i("div",{key:a.id,onClick:pe=>M(a,l),class:"cursor-pointer hover:bg-gray-100 px-4 py-2"},u(a.id)+" - "+u(a.nombre)+" - "+u(x(a.precio))+"€ ",9,se))),128))])):y("",!0)])):b((n(),i("select",{key:1,"onUpdate:modelValue":a=>d(t).productos[l].producto_id=a,class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[o[9]||(o[9]=e("option",{value:""},"Seleccionar producto",-1)),(n(!0),i(v,null,h(f.productos,a=>(n(),i("option",{key:a.id,value:a.id},u(a.id)+" - "+u(a.nombre)+" - "+u(x(a.precio))+"€ ",9,ae))),128))],8,re)),[[k,d(t).productos[l].producto_id]])]),e("div",de,[b(e("input",{type:"number","onUpdate:modelValue":a=>r.cantidad=a,min:"1",placeholder:"Cantidad",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,8,le),[[w,r.cantidad]])]),e("button",{type:"button",onClick:a=>D(l),class:"text-red-600 hover:text-red-900"},o[10]||(o[10]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ne)]))),128))]),e("button",{type:"button",onClick:A,class:"mt-2 inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Agregar Producto ")]),e("div",null,[o[12]||(o[12]=e("label",{for:"observaciones",class:"block text-sm font-medium text-gray-700"},"Observaciones",-1)),b(e("textarea",{id:"observaciones","onUpdate:modelValue":o[3]||(o[3]=r=>d(t).observaciones=r),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[w,d(t).observaciones]])]),e("div",ie,[e("div",ue,[e("span",ce,"Total: "+u(x(N()))+"€",1)])]),e("div",me,[I(d(q),{href:"/albaranes",class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"},{default:j(()=>o[13]||(o[13]=[L(" Cancelar ")])),_:1}),e("button",{type:"submit",class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",disabled:d(t).processing},u(f.albaran?"Actualizar":"Crear"),9,be)])],32)])])]))}};export{fe as default};
