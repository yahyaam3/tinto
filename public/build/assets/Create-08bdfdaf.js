import{f as p,T as C,o,c as E,w as g,a as t,k as y,l as x,u as a,m as _,g as V,b as n,F as u,i as m,t as i,e as F,h as b,v as N,j as h,O as A}from"./app-78229063.js";import{S as T}from"./SidebarLayout-b4c334aa.js";import"./_plugin-vue_export-helper-c27b6911.js";const j={class:"p-6"},B={class:"flex justify-between items-center mb-6"},M={class:"bg-white rounded-lg shadow p-6"},U={key:0,class:"mb-4"},q={class:"mb-6"},L={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},O=["value"],I={class:"mb-6"},P={key:0,class:"text-center py-4"},$={key:1,class:"space-y-4"},z={class:"flex items-center justify-between"},G=["value"],H={class:"font-medium"},J={class:"text-gray-600"},K={class:"mt-2 text-sm text-gray-500"},Q={class:"mt-2 pl-6"},R={key:2,class:"text-gray-500 text-center py-4"},W={class:"flex justify-end gap-4"},X=["disabled"],te={__name:"Create",props:{clientes:Array,albaranes:Array},setup(w){const c=p([]),f=p(!1),s=C({cliente_id:"",fecha:new Date().toISOString().split("T")[0],fecha_vencimiento:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0],albaran_ids:[]}),k=async()=>{if(s.cliente_id)try{f.value=!0,s.albaran_ids=[];const l=await fetch(`/api/clientes/${s.cliente_id}/albaranes-sin-facturar`);if(!l.ok)throw new Error("Error al cargar los albaranes");const e=await l.json();c.value=e}catch(l){console.error("Error:",l),c.value=[]}finally{f.value=!1}else c.value=[]},S=l=>new Date(l).toLocaleDateString(),v=l=>Number(l).toFixed(2),D=()=>{if(!s.cliente_id){s.setError("cliente_id","Debe seleccionar un cliente");return}if(!s.fecha){s.setError("fecha","Debe seleccionar una fecha");return}if(!s.fecha_vencimiento){s.setError("fecha_vencimiento","Debe seleccionar una fecha de vencimiento");return}if(s.albaran_ids.length===0){s.setError("albaran_ids","Debe seleccionar al menos un albarán");return}s.post("/facturas",{onSuccess:()=>{},onError:l=>{console.error("Errores:",l)}})};return(l,e)=>(o(),E(T,null,{default:g(()=>[t("div",j,[t("div",B,[e[5]||(e[5]=t("h2",{class:"text-xl font-semibold text-gray-900"},"Nueva Factura",-1)),y(a(_),{href:"/facturas",class:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors"},{default:g(()=>e[4]||(e[4]=[x(" Volver ")])),_:1})]),t("div",M,[t("form",{onSubmit:V(D,["prevent"])},[a(s).errors?(o(),n("div",U,[(o(!0),n(u,null,m(a(s).errors,(r,d)=>(o(),n("div",{key:d,class:"text-red-600"},i(r),1))),128))])):F("",!0),t("div",q,[e[10]||(e[10]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Datos del Cliente",-1)),t("div",L,[t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700"},"Cliente",-1)),b(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>a(s).cliente_id=r),onChange:k,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:""},[e[6]||(e[6]=t("option",{value:""},"Seleccione un cliente",-1)),(o(!0),n(u,null,m(w.clientes,r=>(o(),n("option",{key:r.id,value:r.id},i(r.nombre),9,O))),128))],544),[[N,a(s).cliente_id]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700"},"Fecha",-1)),b(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=r=>a(s).fecha=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:""},null,512),[[h,a(s).fecha]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700"},"Fecha de Vencimiento",-1)),b(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=r=>a(s).fecha_vencimiento=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:""},null,512),[[h,a(s).fecha_vencimiento]])])])]),t("div",I,[e[12]||(e[12]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Albaranes",-1)),f.value?(o(),n("div",P,e[11]||(e[11]=[t("p",{class:"text-gray-500"},"Cargando albaranes...",-1)]))):c.value.length>0?(o(),n("div",$,[(o(!0),n(u,null,m(c.value,r=>(o(),n("div",{key:r.id,class:"p-4 border rounded-lg"},[t("div",z,[t("div",null,[b(t("input",{type:"checkbox",value:r.id,"onUpdate:modelValue":e[3]||(e[3]=d=>a(s).albaran_ids=d),class:"mr-2"},null,8,G),[[A,a(s).albaran_ids]]),t("span",H,"Albarán #"+i(r.numero),1)]),t("div",J," Fecha: "+i(S(r.fecha))+" - Total: "+i(v(r.total))+"€ ",1)]),t("div",K,i(r.productos.length)+" productos ",1),t("div",Q,[(o(!0),n(u,null,m(r.productos,d=>(o(),n("div",{key:d.id,class:"text-sm text-gray-600"}," - "+i(d.nombre)+" ("+i(d.cantidad)+" x "+i(v(d.precio_unitario))+"€) ",1))),128))])]))),128))])):(o(),n("div",R,i(a(s).cliente_id?"No hay albaranes sin facturar para este cliente":"Seleccione un cliente para ver sus albaranes"),1))]),t("div",W,[y(a(_),{href:"/facturas",class:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors"},{default:g(()=>e[13]||(e[13]=[x(" Cancelar ")])),_:1}),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",disabled:a(s).processing||a(s).albaran_ids.length===0},i(a(s).processing?"Creando...":"Crear Factura"),9,X)])],32)])])]),_:1}))}};export{te as default};
