import{m as U,T as q,f as F,r as L,o as n,c as B,w as p,a as t,t as l,g as E,h as m,v as _,b as u,i as y,F as x,j as T,k as M,l as N}from"./app-78229063.js";import{S as A}from"./SidebarLayout-b4c334aa.js";import{_ as D}from"./_plugin-vue_export-helper-c27b6911.js";const z={components:{Link:U,SidebarLayout:A},props:{factura:Object,clientes:Array,productos:Array},setup(s){var w,P,S,C,V;const o=q({cliente_id:((w=s.factura)==null?void 0:w.cliente_id)||"",fecha:((P=s.factura)==null?void 0:P.fecha)||new Date().toISOString().split("T")[0],estado:((S=s.factura)==null?void 0:S.estado)||"pendiente",productos:((V=(C=s.factura)==null?void 0:C.productos)==null?void 0:V.map(d=>({producto_id:d.id,cantidad:d.pivot.cantidad})))||[]}),i=F(0),e=F(!1),h=()=>{o.productos.push({producto_id:"",cantidad:1})},k=d=>{o.productos.splice(d,1),r()},v=d=>{r()},f=d=>{const g=o.productos[d];if(!g.producto_id)return 0;const b=s.productos.find(j=>j.id===g.producto_id);return b?b.precio*g.cantidad:0},r=()=>{i.value=o.productos.reduce((d,g,b)=>d+f(b),0)},c=d=>Number(d).toFixed(2),a=()=>{if(o.productos.length===0){alert("Debe agregar al menos un producto");return}e.value=!0,s.factura?o.put(`/facturas/${s.factura.id}`,{onSuccess:()=>{e.value=!1},onError:()=>{e.value=!1}}):o.post("/facturas",{onSuccess:()=>{e.value=!1},onError:()=>{e.value=!1}})};return o.productos.length>0&&r(),{form:o,total:i,processing:e,agregarProducto:h,eliminarProducto:k,actualizarPrecio:v,calcularSubtotal:f,calcularTotal:r,formatPrice:c,submit:a}}},I={class:"flex justify-between items-center"},O={class:"text-xl font-semibold text-gray-900"},G={class:"p-6 bg-white rounded-lg shadow"},H={class:"grid grid-cols-1 gap-6 mb-6 md:grid-cols-2"},J=["value"],K={class:"mb-6"},Q={class:"mb-6"},R={class:"flex justify-between items-center mb-4"},W={class:"col-span-6"},X=["onUpdate:modelValue","onChange"],Y=["value"],Z={class:"col-span-2"},$=["onUpdate:modelValue"],oo={class:"col-span-3"},to={class:"text-right py-2"},eo={class:"col-span-1"},ro=["onClick"],ao={class:"flex justify-end mb-6"},so={class:"text-xl font-bold"},io={class:"flex justify-end gap-4"},no=["disabled"];function lo(s,o,i,e,h,k){const v=L("Link"),f=L("SidebarLayout");return n(),B(f,null,{header:p(()=>[t("div",I,[t("h2",O,l(i.factura?"Editar Factura":"Nueva Factura"),1)])]),default:p(()=>[t("div",G,[t("form",{onSubmit:o[5]||(o[5]=E((...r)=>e.submit&&e.submit(...r),["prevent"]))},[t("div",H,[t("div",null,[o[7]||(o[7]=t("label",{class:"block text-sm font-medium text-gray-700"},"Cliente",-1)),m(t("select",{"onUpdate:modelValue":o[0]||(o[0]=r=>e.form.cliente_id=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:""},[o[6]||(o[6]=t("option",{value:""},"Seleccionar cliente",-1)),(n(!0),u(x,null,y(i.clientes,r=>(n(),u("option",{key:r.id,value:r.id},l(r.nombre),9,J))),128))],512),[[_,e.form.cliente_id]])]),t("div",null,[o[8]||(o[8]=t("label",{class:"block text-sm font-medium text-gray-700"},"Fecha",-1)),m(t("input",{type:"date","onUpdate:modelValue":o[1]||(o[1]=r=>e.form.fecha=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:""},null,512),[[T,e.form.fecha]])])]),t("div",K,[o[10]||(o[10]=t("label",{class:"block text-sm font-medium text-gray-700"},"Estado",-1)),m(t("select",{"onUpdate:modelValue":o[2]||(o[2]=r=>e.form.estado=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:""},o[9]||(o[9]=[t("option",{value:"pendiente"},"Pendiente",-1),t("option",{value:"pagada"},"Pagada",-1)]),512),[[_,e.form.estado]])]),t("div",Q,[t("div",R,[o[11]||(o[11]=t("h3",{class:"text-lg font-medium text-gray-900"},"Productos",-1)),t("button",{type:"button",onClick:o[3]||(o[3]=(...r)=>e.agregarProducto&&e.agregarProducto(...r)),class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"}," Agregar Producto ")]),(n(!0),u(x,null,y(e.form.productos,(r,c)=>(n(),u("div",{key:c,class:"grid grid-cols-12 gap-4 mb-4"},[t("div",W,[m(t("select",{"onUpdate:modelValue":a=>r.producto_id=a,class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:"",onChange:a=>e.actualizarPrecio(c)},[o[12]||(o[12]=t("option",{value:""},"Seleccionar producto",-1)),(n(!0),u(x,null,y(i.productos,a=>(n(),u("option",{key:a.id,value:a.id},l(a.nombre)+" - "+l(e.formatPrice(a.precio))+"€ ",9,Y))),128))],40,X),[[_,r.producto_id]])]),t("div",Z,[m(t("input",{type:"number","onUpdate:modelValue":a=>r.cantidad=a,min:"1",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:"",onInput:o[4]||(o[4]=(...a)=>e.calcularTotal&&e.calcularTotal(...a))},null,40,$),[[T,r.cantidad]])]),t("div",oo,[t("div",to,l(e.formatPrice(e.calcularSubtotal(c)))+"€ ",1)]),t("div",eo,[t("button",{type:"button",onClick:a=>e.eliminarProducto(c),class:"text-red-600 hover:text-red-900"},o[13]||(o[13]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ro)])]))),128))]),t("div",ao,[t("div",so," Total: "+l(e.formatPrice(e.total))+"€ ",1)]),t("div",io,[M(v,{href:"/facturas",class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"},{default:p(()=>o[14]||(o[14]=[N(" Cancelar ")])),_:1}),t("button",{type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",disabled:e.processing},l(i.factura?"Actualizar":"Crear")+" Factura ",9,no)])],32)])]),_:1})}const fo=D(z,[["render",lo]]);export{fo as default};
